import numpy as np
import notears
import argparse
import networkx as nx

def main(dag_filename, edge_coefficient_range_from, edge_coefficient_range_to, 
         filename, seed):
    edge_coefficient_range = [edge_coefficient_range_from, edge_coefficient_range_to]
    np.random.seed(seed)

    # IMPORANT, the dag must have been generated by the same method and seed.
    # TODO: This is a workaround since notears dont separate DAG and parameters.
    print(dag_filename)
    
    adjmat = np.loadtxt(dag_filename, delimiter=",",skiprows=1, dtype=int)
    print(adjmat)
    dag = nx.from_numpy_matrix(adjmat, create_using=nx.DiGraph)
    num_nodes = dag.order()
    num_edges = dag.size()

    true_adj_mat, _ = notears.utils.generate_random_dag(num_nodes, num_edges, edge_coefficient_range=edge_coefficient_range)

    header = np.array([list(range(len(true_adj_mat)))])
    tosave = np.append(header,true_adj_mat, axis=0)
    np.savetxt(filename, tosave, delimiter=",", fmt="%f")


if __name__ == "__main__":
    parser = argparse.ArgumentParser("Sample DAG.")

    parser.add_argument(
        '-f', '--edge_coefficient_range_from',
        type=float, required=True
    )
    parser.add_argument(
        '-t', '--edge_coefficient_range_to',
        type=float, required=True
    )
    parser.add_argument(
        '-s', '--seed',
        type=int, required=True
    )
    parser.add_argument(
        '-F', '--filename',
        required=True,
        help="Output filename"
    )
    parser.add_argument(
        '-d', '--dag_filename',
        required=True,
        help="DAG filename"
    )

    args = parser.parse_args()
    main(**args.__dict__)