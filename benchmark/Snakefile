
output_dir="simresults"
replicates=[1, 2]

singularity:
        "docker://onceltuca/graphical_model_benchmark:mytag"

rule sample_dag:
    output:
        "{output_dir}/dag_{replicate}.rds"
    shell:
        "Rscript scripts/sample_dags.R --filename {output} --nodes 20 --parents 2 --seed {wildcards.replicate}"

rule sample_bn:
    input:
        "{output_dir}/dag_{replicate}.rds"
    output:
        bn="{output_dir}/bn_{replicate}.rds"
    shell:
        "Rscript scripts/sample_bayesian_network_for_dag.R "
        "--filename_dag {input} "
        "--filename {output} --seed {wildcards.replicate} "

rule sample_data:
    input:
        "{output_dir}/bn_{replicate}.rds"
    output:
        "{output_dir}/data_{replicate}.csv"
    shell:
        "Rscript scripts/sample_data.R --filename {output} --filename_bn {input} --samples 100 --seed {wildcards.replicate}"

rule sim_blip:
    input: 
        dag="simresults/dag_{replicate}.rds",
        data="simresults/data_{replicate}.csv"
    output: 
        "simresults/ROC_blip_{replicate}.csv"
    message: 
        "Executing blip algorithm on the following files: {input}."
    shell: 
        "Rscript scripts/run_blip.R --filename_data {input.data} "
        "--filename_dag {input.dag} "
        "--output_dir {output_dir} "
        "--replicate {wildcards.replicate} "
        "--max_time 10" 

rule itsearch_map:
    input: 
        dag="simresults/dag_{replicate}.rds",
        data="simresults/data_{replicate}.csv"
    output: 
        "simresults/ROC_itsearch_map_TRUE_{replicate}.csv",
        "simresults/endspace_itsearch_map_TRUE_{replicate}.rds"
    message: 
        "Executing iterative search algorithm on the following files: {input}."
    shell: 
        "Rscript scripts/run_iterative_search.R "
        "--filename_data {input.data} "
        "--filename_dag {input.dag} "
        "--output_dir {output_dir} "
        "--replicate {wildcards.replicate} "
        "--seed {wildcards.replicate} "
        "--map 1"

rule ordermcmc_itsearch_map:
    input: 
        dag="simresults/dag_{replicate}.rds",
        data="simresults/data_{replicate}.csv",
        startspace="simresults/endspace_itsearch_map_TRUE_{replicate}.rds"
    output: 
        "simresults/ROC_orderMCMC_itsearch_{replicate}.csv",
    message: 
        "Executing iterative search algorithm on the following files: {input}."
#    params:
#        seed="{replicate}"
#        filename_data="{input.data}"
#        filename_dag="{input.dag}"

    shell: 
        "Rscript scripts/run_order_mcmc.R "
        "--filename_data {input.data} "
        "--filename_dag {input.dag} "
        "--filename_startspace {input.startspace} "
        "--output_dir {output_dir} "
        "--replicate {wildcards.replicate} "
        "--seed {wildcards.replicate} "

rule plot:
    input: 
        expand(output_dir+"/ROC_blip_{replicate}.csv", replicate=replicates),
        expand(output_dir+"/ROC_itsearch_map_TRUE_{replicate}.csv", replicate=replicates),
        expand(output_dir+"/ROC_orderMCMC_itsearch_{replicate}.csv", replicate=replicates)
    output:
        "{output_dir}/ROC.eps"
    shell: 
        "Rscript scripts/plot_results.R --directory simresults --roc_files {input}"
